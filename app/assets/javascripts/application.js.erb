// This is a manifest file that'll be compiled into including all the files listed below.
// Add new JavaScript/Coffee code in separate files in this directory and they'll automatically
// be included in the compiled file accessible from http://example.com/assets/application.js
// It's not advisable to add code directly here, but if you do, it'll appear at the bottom of the
// the compiled file.
//
//= require jquery
//= require jquery_ujs
//= require jquery_ui
//= require jquery_tmpl
//= require jquery_validate
//= require jquery.tablednd
//= require jquery.transform2d
//= require_self

SUBMARINE = {
  changeListHandler: function(event,ui){
    $(ui.item).removeClass("dragging");
    var moved_issue_id;
    var list_element;
    if($(event.target).is("li")) {
      list_element = $(event.target);
    } else {
      list_element = $(event.target).parents('li'); 
    }
    moved_issue_id = list_element.attr("data-id");
    var data = { moved_issue_id: moved_issue_id, backlog_list: [], sprint_backlog_list: [] };
    data.predecessor_id = $(list_element).prev() && $(list_element).prev().attr("data-id");
    $('ul#backlog_list > li').each(function(i, li){
      data.backlog_list.push($(li).attr("data-id")); 
    });
    $('ul#sprint_backlog_list > li').each(function(i, li){
      data.sprint_backlog_list.push($(li).attr("data-id")); 
    });
    $.ajax({
          type: 'POST',
          url: SUBMARINE.changeListURL,
          data: data,
          error: function(){window.alert(SUBMARINE.messages.save_failed)}});
    SUBMARINE.showStoryPointsSum();
  },
  toggleDescription: function(event){
    if($(this).hasClass("short")){
      $(this).removeClass("short");
	  $(this).parent().css('height', $(this).height());
    } else {
      $(this).addClass("short");
	  $(this).parent().css('height', $(this).height());	  
    }
  },
  showControls: function(event){
    $(this).find('div.controls').fadeIn(80);
  },
  hideControls: function(event){
    $(this).find('div.controls').fadeOut(80);
  },
  showStoryPointsSum: function(){
    var sum = 0;
    var elements = $('ul#sprint_backlog_list > li');
    $.each(elements, function(i, element) {
      value = parseInt($(element).attr('data-story_points'), 10);
      if(!!value) {
        sum += value;
      }
    });
    $('#story_points_sum').html(sum);
  },
  check_radio_image: function(){
    // animate
    $('.sp_radio_images .radio_image').addClass('inactive');
    $(this).animate({transform: 'translateY(-10px) scale(1.3)'});
    $(this).removeClass('inactive');
    $('.radio_image.inactive').animate({transform: 'translateY(0px) scale(1)'});

    // set value in form
    $(this).siblings('input').val($(this).attr('data-sp-value'));
  },
  messages: {}
}
